<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>iColor Picker</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/color-thief/2.3.2/color-thief.umd.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --ios-blue: #007AFF;
            --glass-bg: rgba(255, 255, 255, 0.75);
            --glass-border: rgba(255, 255, 255, 0.4);
            --shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f6d365 0%, #fda085 100%);
            margin: 0; padding: 20px;
            color: #000; min-height: 100vh;
            display: flex; flex-direction: column; align-items: center;
        }

        /* Glassmorphism Card */
        .glass-card {
            background: var(--glass-bg);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-radius: 20px;
            border: 1px solid var(--glass-border);
            box-shadow: var(--shadow);
            padding: 20px; width: 100%; box-sizing: border-box;
            margin-bottom: 15px;
            transition: transform 0.2s;
        }

        /* Preview Box */
        .preview-box {
            width: 100%; height: 140px; border-radius: 18px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            position: relative; margin-bottom: 20px;
            display: flex; align-items: center; justify-content: center;
            font-size: 24px; font-weight: bold; color: rgba(255,255,255,0.9);
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
            transition: background 0.3s ease;
        }

        /* Tabs (iOS Segmented Control) */
        .segmented-control {
            display: flex; background: rgba(0,0,0,0.05);
            padding: 4px; border-radius: 12px; margin-bottom: 20px; width: 100%;
        }
        .tab {
            flex: 1; padding: 8px; text-align: center;
            font-size: 13px; font-weight: 600; cursor: pointer;
            border-radius: 8px; color: #666; transition: 0.3s;
        }
        .tab.active {
            background: #fff; color: #000;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        /* Inputs */
        .row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; font-size: 14px; }
        .val { font-family: monospace; font-weight: 700; color: #333; }
        
        input[type="color"] {
            -webkit-appearance: none; border: none; width: 50px; height: 50px;
            border-radius: 50%; overflow: hidden; cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2); border: 2px solid #fff;
        }
        input[type="color"]::-webkit-color-swatch-wrapper { padding: 0; }
        input[type="color"]::-webkit-color-swatch { border: none; }

        /* Buttons */
        .ios-btn {
            background: var(--ios-blue); color: white; border: none;
            width: 100%; padding: 14px; border-radius: 14px;
            font-size: 16px; font-weight: 600; cursor: pointer;
            display: flex; justify-content: center; align-items: center; gap: 8px;
        }
        .ios-btn:active { opacity: 0.8; transform: scale(0.98); }

        .hidden { display: none; }
        canvas { width: 100%; border-radius: 12px; margin-top: 10px; display: none; }
        
        /* Toast Notification */
        .toast {
            position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%);
            background: rgba(0,0,0,0.8); color: white; padding: 10px 20px;
            border-radius: 20px; font-size: 12px; opacity: 0; transition: 0.3s; pointer-events: none;
        }
        .toast.show { opacity: 1; bottom: 100px; }
    </style>
</head>
<body>

    <div class="glass-card" style="padding: 6px;">
        <div class="segmented-control">
            <div class="tab active" onclick="setTab('solid')">Solid</div>
            <div class="tab" onclick="setTab('gradient')">Gradient</div>
            <div class="tab" onclick="setTab('image')">Rasm</div>
        </div>
    </div>

    <div class="preview-box" id="mainPreview" style="background: #007AFF;">
        <span id="hexTitle">#007AFF</span>
    </div>

    <div id="solidSec" class="glass-card">
        <div class="row">
            <span>Rangni tanlang</span>
            <input type="color" id="solidInput" value="#007AFF">
        </div>
        <div class="row"><span style="opacity:0.6">RGB</span><span class="val" id="rgbVal">0, 122, 255</span></div>
        <div class="row"><span style="opacity:0.6">CMYK</span><span class="val" id="cmykVal">100, 52, 0, 0</span></div>
    </div>

    <div id="gradientSec" class="glass-card hidden">
        <div class="row">
            <span>1-Rang</span>
            <input type="color" id="grad1" value="#f6d365">
        </div>
        <div class="row">
            <span>2-Rang</span>
            <input type="color" id="grad2" value="#fda085">
        </div>
        <div class="row">
            <span>CSS Kod</span>
            <span class="val" id="cssVal" style="font-size:10px; max-width: 150px; overflow:hidden;">linear-gradient...</span>
        </div>
    </div>

    <div id="imageSec" class="glass-card hidden">
        <label class="ios-btn" style="background: #34c759;">
            ðŸ“· Rasm Yuklash
            <input type="file" id="fileInput" accept="image/*" style="display:none">
        </label>
        <canvas id="canvas"></canvas>
        <p style="text-align:center; font-size:12px; color:#666; margin-top:10px">Rang olish uchun rasm ustiga bosing</p>
    </div>

    <div class="toast" id="toast">Nusxalandi!</div>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();
    const colorThief = new ColorThief();

    // State
    let mode = 'solid'; 
    let currentData = { hex: "#007AFF", type: "solid" };

    // Elements
    const preview = document.getElementById('mainPreview');
    const title = document.getElementById('hexTitle');
    const toast = document.getElementById('toast');

    // Setup Button
    tg.MainButton.text = "Yuborish";
    tg.MainButton.show();
    tg.MainButton.onClick(() => tg.sendData(JSON.stringify(currentData)));

    // Tab Logic
    function setTab(m) {
        mode = m;
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.glass-card').forEach(c => {
           if(c.id !== 'solidSec' && c.id !== 'gradientSec' && c.id !== 'imageSec') return; // Tab cardni yashirmaslik uchun
           c.classList.add('hidden');
        });

        if(m === 'solid') {
            document.querySelectorAll('.tab')[0].classList.add('active');
            document.getElementById('solidSec').classList.remove('hidden');
            updateSolid(document.getElementById('solidInput').value);
        } else if (m === 'gradient') {
            document.querySelectorAll('.tab')[1].classList.add('active');
            document.getElementById('gradientSec').classList.remove('hidden');
            updateGradient();
        } else {
            document.querySelectorAll('.tab')[2].classList.add('active');
            document.getElementById('imageSec').classList.remove('hidden');
        }
    }

    // SOLID Logic
    const solidInput = document.getElementById('solidInput');
    solidInput.addEventListener('input', (e) => updateSolid(e.target.value));

    function updateSolid(hex) {
        currentData = { hex: hex, type: 'solid' };
        preview.style.background = hex;
        title.innerText = hex.toUpperCase();
        
        // RGB Calc
        const r = parseInt(hex.substr(1,2),16), g = parseInt(hex.substr(3,2),16), b = parseInt(hex.substr(5,2),16);
        document.getElementById('rgbVal').innerText = `${r}, ${g}, ${b}`;
        
        // Background update for immersion
        document.body.style.background = hex;
    }

    // GRADIENT Logic
    const g1 = document.getElementById('grad1');
    const g2 = document.getElementById('grad2');
    g1.addEventListener('input', updateGradient);
    g2.addEventListener('input', updateGradient);

    function updateGradient() {
        const css = `linear-gradient(135deg, ${g1.value}, ${g2.value})`;
        preview.style.background = css;
        title.innerText = "Gradient";
        document.getElementById('cssVal').innerText = css;
        document.body.style.background = css;
        
        currentData = { 
            type: 'gradient', 
            css: css, 
            color1: g1.value, 
            color2: g2.value 
        };
    }

    // IMAGE Logic
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    
    document.getElementById('fileInput').addEventListener('change', function(e) {
        const reader = new FileReader();
        reader.onload = function(event) {
            const img = new Image();
            img.onload = function() {
                canvas.width = 320;
                canvas.height = 320 * (img.height / img.width);
                ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                canvas.style.display = 'block';
            }
            img.src = event.target.result;
        }
        reader.readAsDataURL(e.target.files[0]);
    });

    canvas.addEventListener('click', (e) => {
        const rect = canvas.getBoundingClientRect();
        const data = ctx.getImageData(e.clientX - rect.left, e.clientY - rect.top, 1, 1).data;
        const hex = "#" + ((1 << 24) + (data[0] << 16) + (data[1] << 8) + data[2]).toString(16).slice(1).toUpperCase();
        updateSolid(hex);
        mode = 'solid'; // Switch logic visually but keep image visible? No, let's just update solid data
        title.innerText = hex;
        preview.style.background = hex;
    });

</script>
</body>
</html>